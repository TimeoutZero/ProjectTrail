---
machine:
  java:
    version: oraclejdk8
  services:
  - docker

dependencies:
  override:
    - npm install -g bower
    - npm install -g gulp

test:
  override:

    - docker login -e="lucas.gmmartins@gmail.com.br" -u="lucasgmartins" -p="futebol025"

    # BUILD BACK

    - cd server; mvn clean package; cd ..;

    # BUILD FRONT

    - cd client/web; npm install; bower install; gulp release; cd ../../;

    # BUILD BACK CONTAINER
    - docker build -t ireadme/core server
    - docker push ireadme/core

    # BUILD FRONT CONTAINER
    - docker build -t ireadme/web client/web
    - docker push ireadme/web

    # BACKUP
    - mv server/target/ireadme.jar $CIRCLE_ARTIFACTS/ireadme.jar
